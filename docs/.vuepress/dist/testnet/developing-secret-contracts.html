<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developing Secret Contracts</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.1fbdf1a8.css" as="style"><link rel="preload" href="/assets/js/app.368a618c.js" as="script"><link rel="preload" href="/assets/js/2.9865b56c.js" as="script"><link rel="preload" href="/assets/js/12.65bf0c1d.js" as="script"><link rel="prefetch" href="/assets/js/10.3aea5455.js"><link rel="prefetch" href="/assets/js/11.2822ea64.js"><link rel="prefetch" href="/assets/js/13.d1066a1e.js"><link rel="prefetch" href="/assets/js/14.0b9eb2b2.js"><link rel="prefetch" href="/assets/js/15.b2efccab.js"><link rel="prefetch" href="/assets/js/16.66c9f6c5.js"><link rel="prefetch" href="/assets/js/17.fbf8928e.js"><link rel="prefetch" href="/assets/js/18.45dc0496.js"><link rel="prefetch" href="/assets/js/19.b85fb333.js"><link rel="prefetch" href="/assets/js/20.5446fbc2.js"><link rel="prefetch" href="/assets/js/21.2c41cf8d.js"><link rel="prefetch" href="/assets/js/22.c981324b.js"><link rel="prefetch" href="/assets/js/23.831e29c2.js"><link rel="prefetch" href="/assets/js/24.025efe88.js"><link rel="prefetch" href="/assets/js/25.dad4cc47.js"><link rel="prefetch" href="/assets/js/26.4113f459.js"><link rel="prefetch" href="/assets/js/27.e9ef666f.js"><link rel="prefetch" href="/assets/js/28.8d35786b.js"><link rel="prefetch" href="/assets/js/29.ed008a30.js"><link rel="prefetch" href="/assets/js/3.6e48e99b.js"><link rel="prefetch" href="/assets/js/30.3d5f6431.js"><link rel="prefetch" href="/assets/js/31.d37d7059.js"><link rel="prefetch" href="/assets/js/32.26db99ea.js"><link rel="prefetch" href="/assets/js/33.6f451fda.js"><link rel="prefetch" href="/assets/js/34.c61840b6.js"><link rel="prefetch" href="/assets/js/35.0b0b2a65.js"><link rel="prefetch" href="/assets/js/36.3e33e871.js"><link rel="prefetch" href="/assets/js/37.68ff07f2.js"><link rel="prefetch" href="/assets/js/38.f5fd2d60.js"><link rel="prefetch" href="/assets/js/39.2aa4c5de.js"><link rel="prefetch" href="/assets/js/4.8825709b.js"><link rel="prefetch" href="/assets/js/40.735d1201.js"><link rel="prefetch" href="/assets/js/41.316ad2f5.js"><link rel="prefetch" href="/assets/js/42.97ba8168.js"><link rel="prefetch" href="/assets/js/43.cf3d0784.js"><link rel="prefetch" href="/assets/js/44.982887eb.js"><link rel="prefetch" href="/assets/js/45.2585af80.js"><link rel="prefetch" href="/assets/js/46.dd0f01fe.js"><link rel="prefetch" href="/assets/js/47.ce523662.js"><link rel="prefetch" href="/assets/js/48.03991a46.js"><link rel="prefetch" href="/assets/js/49.e717e995.js"><link rel="prefetch" href="/assets/js/5.c2232815.js"><link rel="prefetch" href="/assets/js/50.392a7165.js"><link rel="prefetch" href="/assets/js/51.db64bb96.js"><link rel="prefetch" href="/assets/js/52.1280a756.js"><link rel="prefetch" href="/assets/js/53.735f471f.js"><link rel="prefetch" href="/assets/js/54.69d97fc6.js"><link rel="prefetch" href="/assets/js/55.a1c18e81.js"><link rel="prefetch" href="/assets/js/56.a8deed1a.js"><link rel="prefetch" href="/assets/js/57.3b86dcef.js"><link rel="prefetch" href="/assets/js/58.2913b075.js"><link rel="prefetch" href="/assets/js/59.6ce31797.js"><link rel="prefetch" href="/assets/js/6.40f24f85.js"><link rel="prefetch" href="/assets/js/60.bd430ea0.js"><link rel="prefetch" href="/assets/js/61.b55b53cd.js"><link rel="prefetch" href="/assets/js/62.77ffd21b.js"><link rel="prefetch" href="/assets/js/63.fa587683.js"><link rel="prefetch" href="/assets/js/64.366b7771.js"><link rel="prefetch" href="/assets/js/65.e5dd6793.js"><link rel="prefetch" href="/assets/js/66.5c5e7f92.js"><link rel="prefetch" href="/assets/js/67.3bdba1ce.js"><link rel="prefetch" href="/assets/js/68.298d1f3e.js"><link rel="prefetch" href="/assets/js/69.08559541.js"><link rel="prefetch" href="/assets/js/7.49199302.js"><link rel="prefetch" href="/assets/js/70.2603c4a4.js"><link rel="prefetch" href="/assets/js/71.dd6a8160.js"><link rel="prefetch" href="/assets/js/72.0d97b9ee.js"><link rel="prefetch" href="/assets/js/73.aefdd0e9.js"><link rel="prefetch" href="/assets/js/74.73ff8ff9.js"><link rel="prefetch" href="/assets/js/75.04c062f4.js"><link rel="prefetch" href="/assets/js/76.e94b0ecc.js"><link rel="prefetch" href="/assets/js/77.ed7afbb7.js"><link rel="prefetch" href="/assets/js/78.9fe2b885.js"><link rel="prefetch" href="/assets/js/79.9ceb8bfc.js"><link rel="prefetch" href="/assets/js/8.a8efa35d.js"><link rel="prefetch" href="/assets/js/80.defd37e0.js"><link rel="prefetch" href="/assets/js/81.ffce598d.js"><link rel="prefetch" href="/assets/js/82.29d8cab7.js"><link rel="prefetch" href="/assets/js/83.f1632309.js"><link rel="prefetch" href="/assets/js/84.8a5a3473.js"><link rel="prefetch" href="/assets/js/85.1b7789c6.js"><link rel="prefetch" href="/assets/js/86.a93b488d.js"><link rel="prefetch" href="/assets/js/87.4550bce0.js"><link rel="prefetch" href="/assets/js/88.3bab9ce8.js"><link rel="prefetch" href="/assets/js/89.3a7e9f0a.js"><link rel="prefetch" href="/assets/js/9.34ad9346.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1fbdf1a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="developing-secret-contracts"><a href="#developing-secret-contracts" class="header-anchor">#</a> Developing Secret Contracts</h1> <p>Secret Contacts are based on CosmWasm v0.10.</p> <p>Check out the <a href="https://docs.cosmwasm.com" target="_blank" rel="noopener noreferrer">CosmWasm docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as well. They are probably more extensive.</p> <p>Don't forget to go over the <a href="#differences-from-cosmwasm">differences between SecretWasm and CosmWasm</a>.</p> <ul><li><a href="#developing-secret-contracts">Developing Secret Contracts</a> <ul><li><a href="#ides">IDEs</a></li> <li><a href="#personal-secret-network-for-secret-contract-development">Personal Secret Network for Secret Contract development</a></li> <li><a href="#init">Init</a></li> <li><a href="#handle">Handle</a></li> <li><a href="#query">Query</a></li> <li><a href="#inputs">Inputs</a></li> <li><a href="#apis">APIs</a></li> <li><a href="#state">State</a></li> <li><a href="#some-librariescrates-considerations">Some libraries/crates considerations</a></li> <li><a href="#randomness">Randomness</a> <ul><li><a href="#roll-your-own">Roll your own</a> <ul><li><a href="#poker-deck-shuffling-example">Poker deck shuffling example</a></li></ul></li> <li><a href="#use-an-external-oracle">Use an external oracle</a></li></ul></li> <li><a href="#outputs">Outputs</a></li> <li><a href="#external-query">External query</a></li> <li><a href="#compiling">Compiling</a> <ul><li><a href="#with-docker">With docker</a></li> <li><a href="#without-docker">Without docker</a></li></ul></li> <li><a href="#storing-and-deploying">Storing and deploying</a></li> <li><a href="#verifying-your-contract-code-on-explorers">Verifying your contract code on explorers</a></li> <li><a href="#testing">Testing</a></li> <li><a href="#debugging">Debugging</a></li> <li><a href="#building-secret-apps-with-secretjs">Building secret apps with SecretJS</a> <ul><li><a href="#wallet-integration">Wallet integration</a></li></ul></li> <li><a href="#differences-from-cosmwasm">Differences from CosmWasm</a></li></ul></li></ul> <h2 id="ides"><a href="#ides" class="header-anchor">#</a> IDEs</h2> <p>Secret Contracts are developed with the <a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">Rust<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> programming language and compiled to <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WASM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> binaries.</p> <p>These IDEs are known to work very well for developing Secret Contracts:</p> <ul><li><a href="https://www.jetbrains.com/clion/" target="_blank" rel="noopener noreferrer">CLion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">VSCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with the <a href="https://rust-analyzer.github.io/" target="_blank" rel="noopener noreferrer">rust-analyzer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> extension</li></ul> <h2 id="personal-secret-network-for-secret-contract-development"><a href="#personal-secret-network-for-secret-contract-development" class="header-anchor">#</a> Personal Secret Network for Secret Contract development</h2> <p>The developer blockchain is configured to run inside a docker container. Install <a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for your environment (Mac, Windows, Linux).</p> <p>Open a terminal window and change to your project directory.
Then start SecretNetwork, labelled <em>secretdev</em>:</p> <div class="language- extra-class"><pre class="language-text"><code>$ docker run -it --rm \
 -p 26657:26657 -p 26656:26656 -p 1317:1317 \
 --name secretdev enigmampc/secret-network-bootstrap-sw:latest
</code></pre></div><p><strong>NOTE</strong>: The <em>secretdev</em> docker container can be stopped with Ctrl+C</p> <p>At this point you're running a local SecretNetwork full-node. Let's connect to the container so we can view and manage the secret keys:</p> <p><strong>NOTE</strong>: In a new terminal</p> <div class="language- extra-class"><pre class="language-text"><code>docker exec -it secretdev /bin/bash
</code></pre></div><p>The local blockchain has a couple of keys setup for you (similar to accounts if you're familiar with Truffle Ganache). The keys are stored in the <code>test</code> keyring backend, which makes it easier for local development and testing.</p> <div class="language- extra-class"><pre class="language-text"><code>secretcli keys list --keyring-backend test
</code></pre></div><p><img src="/assets/img/secretcli_keys_list.3418ae8c.png" alt=""></p> <p><code>exit</code> when you are done.</p> <h2 id="init"><a href="#init" class="header-anchor">#</a> Init</h2> <p><code>init</code> is the constructor of your contract. This function is called only once in the lifetime of the contract.</p> <p>Example Invocation from <code>secretcli</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>secretcli tx compute instantiate <span class="token string">&quot;<span class="token variable">$CODE_ID</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$INPUT_MSG</span>&quot;</span> --label <span class="token string">&quot;<span class="token variable">$UNIQUE_LABEL</span>&quot;</span> --from <span class="token string">&quot;<span class="token variable">$MY_KEY</span>&quot;</span>
</code></pre></div><p>Example Invocation from <code>SecretJS</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TODO</span>
</code></pre></div><h2 id="handle"><a href="#handle" class="header-anchor">#</a> Handle</h2> <p><code>handle</code> is the implementation of execute transactions.</p> <p>Example Invocation from <code>secretcli</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>secretcli tx compute execute <span class="token string">&quot;<span class="token variable">$CONTRACT_ADDRESS</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$INPUT_ARGS</span>&quot;</span> --from <span class="token string">&quot;<span class="token variable">$MY_KEY</span>&quot;</span> <span class="token comment"># Option A</span>
secretcli tx compute execute --label <span class="token string">&quot;<span class="token variable">$LABEL</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$INPUT_ARGS</span>&quot;</span> --from <span class="token string">&quot;<span class="token variable">$MY_KEY</span>&quot;</span>    <span class="token comment"># Option B</span>
</code></pre></div><p>Example Invocation from <code>SecretJS</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TODO</span>
</code></pre></div><h2 id="query"><a href="#query" class="header-anchor">#</a> Query</h2> <p><code>query</code> is the implementation of read-only queries. Queries run over the current blockchain state but don't incur fees and don't have access to <code>msg.sender</code>. They are still metered by a gas limit that is set on the executing node.</p> <p>Example Invocation from <code>secretcli</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>secretcli q compute query <span class="token string">&quot;<span class="token variable">$CONTRACT_ADDRESS</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$INPUT_ARGS</span>&quot;</span>
</code></pre></div><p>Example Invocation from <code>SecretJS</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TODO</span>
</code></pre></div><h2 id="inputs"><a href="#inputs" class="header-anchor">#</a> Inputs</h2> <h2 id="apis"><a href="#apis" class="header-anchor">#</a> APIs</h2> <h2 id="state"><a href="#state" class="header-anchor">#</a> State</h2> <h2 id="some-libraries-crates-considerations"><a href="#some-libraries-crates-considerations" class="header-anchor">#</a> Some libraries/crates considerations</h2> <ul><li><code>bincode2</code> instead of <code>bincode</code> for serializing data.</li> <li><code>serde_json_wasm</code> instead of <code>serde_json</code> for serializing data.</li> <li><code>bech32</code> instead of <code>deps.api.canonical_address</code> and <code>deps.api.human_address</code>, as they only support <code>secret</code> prefix (E.g. not <code>secretvaloper</code> for staking use-cases).</li></ul> <h2 id="randomness"><a href="#randomness" class="header-anchor">#</a> Randomness</h2> <h3 id="roll-your-own"><a href="#roll-your-own" class="header-anchor">#</a> Roll your own</h3> <h4 id="poker-deck-shuffling-example"><a href="#poker-deck-shuffling-example" class="header-anchor">#</a> Poker deck shuffling example</h4> <ol><li>When joining a room, <a href="https://github.com/enigmampc/SecretHoldEm/blob/4f67c469bb4a0f53522c7ad069e54ae5c1effb6b/contract/src/contract.rs#L172" target="_blank" rel="noopener noreferrer">each player sends a secret number<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>Once the room is full, all secrets are combined with sha256 to <a href="https://github.com/enigmampc/SecretHoldEm/blob/4f67c469bb4a0f53522c7ad069e54ae5c1effb6b/contract/src/contract.rs#L349-L355" target="_blank" rel="noopener noreferrer">create a random seed<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>With that seed, the <a href="https://github.com/enigmampc/SecretHoldEm/blob/4f67c469bb4a0f53522c7ad069e54ae5c1effb6b/contract/src/contract.rs#L356-L357" target="_blank" rel="noopener noreferrer">deck is shuffled<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>Each round a <a href="https://github.com/enigmampc/SecretHoldEm/blob/4f67c469bb4a0f53522c7ad069e54ae5c1effb6b/contract/src/contract.rs#L602-L614" target="_blank" rel="noopener noreferrer">game counter is incremented<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and along with the players' secrets is used to create a new seed for re-shuffling the deck.</li> <li>On the frondend side, <a href="https://github.com/enigmampc/SecretHoldEm/blob/4f67c469bb4a0f53522c7ad069e54ae5c1effb6b/gui/src/App.js#L334-L354" target="_blank" rel="noopener noreferrer">SecretJS is used to generate a secure random number<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and sends it as a secret when a player joins the table. A random number is not really necessary, and every secret number would work just as well.</li> <li>As long as at least one player is not colluding with the rest, and by properties of sha256, the seeds for shuffling the deck are known only to the contract and to no one else. If all players are colliding, they might as well all play with open hands. ðŸ˜‚</li></ol> <h3 id="use-an-external-oracle"><a href="#use-an-external-oracle" class="header-anchor">#</a> Use an external oracle</h3> <p>No implementation exists yet, but it's not that hard to implement.</p> <p>For example:</p> <ol><li>Have a <code>handle</code> function <code>input_entropy</code> for users to send entropy in.</li> <li><code>input_entropy</code> will have a storage key named <code>seed</code>.</li> <li>On each input to <code>input_entropy</code>, <code>seed = hash(seed + input)</code>.</li> <li>Have another <code>handle</code> function <code>get_random_number</code> for users to get a random number.</li> <li><code>get_random_number</code> must also add to the entropy pool, otherwise consecutive <code>get_random_number</code> calls will output the same random number. For example <code>seed = hash(seed + msg.sender + block.height + ...)</code>.</li> <li><code>get_random_number</code> will just return the <code>hash(seed)</code> or some other non-reversible derivative of it, and update the <code>seed</code> with the new entropy like described in the previous point.</li> <li>Have <code>get_random_number</code> also callback to the caller contract with the random number.</li> <li>You can even have a cron job to send data from <a href="https://www.random.org/" target="_blank" rel="noopener noreferrer">random.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to <code>input_entropy</code>.</li></ol> <p>This exmaple has a much worse UX than rolling your own randomness, but at least contracts won't have to rely on users to send entropy and also won't take the risk of messing up the implementation.</p> <h2 id="outputs"><a href="#outputs" class="header-anchor">#</a> Outputs</h2> <h2 id="external-query"><a href="#external-query" class="header-anchor">#</a> External query</h2> <h2 id="compiling"><a href="#compiling" class="header-anchor">#</a> Compiling</h2> <h3 id="with-docker"><a href="#with-docker" class="header-anchor">#</a> With docker</h3> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run --rm -it -v /absolute/path/to/contract/project:/contract enigmampc/secret-contract-optimizer
</code></pre></div><p>Where <code>/absolute/path/to/contract/project</code> is pointing to the directory that contains your Secret Contract's <code>Cargo.toml</code>.</p> <p>This will output an optimized build file <code>/absolute/path/to/contract/project/contract.wasm.gz</code>.</p> <h3 id="without-docker"><a href="#without-docker" class="header-anchor">#</a> Without docker</h3> <div class="language-console extra-class"><pre class="language-text"><code>$ rustup target add wasm32-unknown-unknown
$ sudo apt install binaryen
</code></pre></div><div class="language-console extra-class"><pre class="language-text"><code>$ RUSTFLAGS='-C link-arg=-s' cargo build --release --target wasm32-unknown-unknown --locked
$ wasm-opt -Oz ./target/wasm32-unknown-unknown/release/*.wasm -o ./contract.wasm
$ cat ./contract.wasm | gzip -9 &gt; ./contract.wasm.gz
</code></pre></div><p>Breakdown:</p> <ol><li>Build a release mode WASM file, strip symbols</li> <li>Further optimize with <a href="https://github.com/WebAssembly/binaryen" target="_blank" rel="noopener noreferrer">wasm-opt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Gzip</li></ol> <h2 id="storing-and-deploying"><a href="#storing-and-deploying" class="header-anchor">#</a> Storing and deploying</h2> <h2 id="verifying-your-contract-code-on-explorers"><a href="#verifying-your-contract-code-on-explorers" class="header-anchor">#</a> Verifying your contract code on explorers</h2> <h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <h2 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h2> <h2 id="building-secret-apps-with-secretjs"><a href="#building-secret-apps-with-secretjs" class="header-anchor">#</a> Building secret apps with SecretJS</h2> <p>A Secret App, or a SApp, is a DApp with computational and data privacy.
A Secret App is usually comprised of the following components:</p> <ul><li>A Secret Contract deployed on the Secret Network</li> <li>A frontend app built with a JavaScript framework (E.g. ReactJS, VueJS, AngularJS, etc.)</li> <li>The frontend app connects to the Secret Network using SecretJS,</li> <li>SecretJS interacts with a REST API exposed by nodes in the Secret Network. The REST API/HTTPS server is commonly referred to as LCD Server (Light Client Daemon :shrug:). Usually by connecting SecretJS with a wallet, the wallet handles the interactions with the LCD server.</li></ul> <h3 id="wallet-integration"><a href="#wallet-integration" class="header-anchor">#</a> Wallet integration</h3> <p>Still not implemented in wallets. Can implement a local wallet but this will probably won't be needed anymore after 2020.</p> <h1 id="differences-from-cosmwasm"><a href="#differences-from-cosmwasm" class="header-anchor">#</a> Differences from CosmWasm</h1> <p>Secret Contacts are based on CosmWasm v0.10, but in order to preserve privacy, they diverge in functionality in some cases.</p> <ul><li><code>code_hash</code> in callbacks</li> <li>Can access the current contract's <code>code_hash</code> via <code>env.contract_code_hash</code></li> <li>contract labels are unique, thus mandatory on callback to <code>init</code></li> <li><code>migrate</code> and <code>admin</code> for contracts is not allowed</li> <li>iterator (<code>db_scan</code>, <code>db_next</code>) on contract state keys is not allowed</li> <li><code>cosmwasm_std</code> changes...</li> <li>SGX memory limits (30 MiB total, 12 MiB per contract vs 32 MiB per contract)</li> <li>We charge gas for memory allocations, vanilla CosmWasm don't</li> <li><code>SecretJS</code> has a new function - <code>GenerateNewSeed</code> to help apps to get a secure 32 byte random number</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.368a618c.js" defer></script><script src="/assets/js/2.9865b56c.js" defer></script><script src="/assets/js/12.65bf0c1d.js" defer></script>
  </body>
</html>
